<!-- Generated by GitHub Copilot assistant; edit as needed -->
# Copilot / AI Agent Instructions

These notes help an AI coding assistant be productive in this monorepo. Focus on small, non-breaking edits and prefer changes that preserve package APIs.

- **Repo layout:** workspace root uses npm workspaces. Key folders: `ui/*`, `packages/*`, `services/*`.
- **Shared libraries:** `packages/ms-task-app-common`, `packages/ms-task-app-dto`, `packages/ms-task-app-entities`, `packages/ms-task-app-auth`, `packages/ms-task-app-service-util` hold reusable types, zod schemas, auth adapters, mTLS helpers, and DB/MQ helpers. Prefer adding helpers here when functionality is cross-service.

- **Services:** Each microservice lives under `services/` and follows the Express + Mongoose pattern. Entry files are `services/<service>/index.ts` and service `package.json` scripts follow workspace conventions. Examples: `services/task-service`, `services/oauth-service`, `services/notification-service`.

- **Web UI:** `ui/ms-task-app-web` is a Next.js app. API clients used by the UI live under `ui/ms-task-app-web/lib/api-clients` and the auth gateway is implemented inside the Next app.

- **Security & Networking:** The project uses mTLS for internal service-to-service calls. Look at `packages/ms-task-app-auth/mtls/mtls-fetch.ts` and `dev-setup/create-dev-certs.ps1` for cert generation. Docker compose mounts certs and uses Docker secrets in `docker-compose.yml`.

- **Validation & Types:** Validation is done with `zod` and shared DTOs live in `packages/ms-task-app-dto`. DB entities and schemas are in `packages/ms-task-app-entities`.

- **Common patterns to follow in patches:**
  - Use existing zod schemas from `packages/ms-task-app-dto` when adding or validating request/response payloads.
  - Use `ms-task-app-service-util/db/mongodb-helpers.ts` for DB connections and helpers to avoid duplicated connection code.
  - For cross-service HTTP calls, prefer the mTLS helper `mtls-fetch.ts` or auth adapters under `packages/ms-task-app-auth`.

- **Local dev & build commands:**
  - Start a single service dev: `npm run dev:task-service` or `npm run dev:oauth-service` (root script forwards to workspace `dev` script).
  - Start the UI dev: `npm run dev:web`.
  - Build individual workspaces: `npm run build:common`, `npm run build:task-service`, `npm run build:web`.
  - Bring up the full local environment (containers): `npm run compose:dev` (requires Docker Desktop). Use `npm run compose:down` to stop.
    - `npm run compose:dev`: starts only the infrastructure services used for local development (examples: `mongo`, `rabbitmq`, `smtp-server`). It does NOT start the microservices or the web UI; use it when you want the infra running and prefer to run individual services with `npm run dev:<service>` for faster iteration.
    - `npm run compose:up`: starts *all* services defined in `docker-compose.yml`, including microservices and the web UI. Use this when you need the entire composed environment to be available.

- **Dev certs and env:** See `dev-setup/create-dev-certs.ps1` for Windows PowerShell cert creation commands. Environment variable examples and `.env.example` are referenced in `docker-compose.yml`.

- **Code style & linting:** Run `npm run lint` (root) to lint the repo and `npm run format` to run Prettier. Next.js app has its own ESLint config in `ui/ms-task-app-web/eslint.config.mjs`.

- **Tests:** There are no central unit tests in the monorepo root. Avoid adding large test infra changes unless requested.

- **What NOT to do:**
  - Do not change package public APIs in `packages/*` without updating all dependent services and the UI.
  - Avoid altering Docker networking or secrets without careful checks — these affect the whole local compose pod.

- **Helpful entry points to inspect when coding:**
  - `PLANNING.md` — high-level architecture and routes
  - `notes.md` — local run commands, docker build/run examples, cert steps
  - `packages/ms-task-app-auth/authjs-rest-adapter.ts` — how auth is wired to services
  - `packages/ms-task-app-service-util/db/mongodb-helpers.ts` — DB connection helper
  - `packages/ms-task-app-auth/mtls/mtls-fetch.ts` — service-to-service mTLS fetch helper
  - `ui/ms-task-app-web/lib/api-clients` — clients that call services from the UI
